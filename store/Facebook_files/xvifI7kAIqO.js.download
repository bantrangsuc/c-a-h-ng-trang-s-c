;/*FB_PKG_DELIM*/

__d("MAWEncryptedBackupsUpdateGlobalRestoreStatus",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set(),j=new Set();function k(a){if(a==="restore")return i;else return j}function a(a,b){b=k(b);b.add(a)}function b(a,b){b=k(b);b.has(a)?b["delete"](a):d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with thread id "," is not currently being tracked, but restore seems to be in progress"])),a)}function c(a){a=k(a);return a.size}g.addThreadIdToStatusArray=a;g.removeThreadIdFromStatusArray=b;g.getCurrentGlobalRestoreStatusArrayLength=c}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["EBLogger","ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","WAJobOrchestratorTypes","WATagsLogger","asyncToGeneratorRuntime","cr:4992","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(p||(p=d("I64"))).of_string(c)));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(n||(n=b("Promise"))).reject(a)}return});return r.apply(this,arguments)}function s(a,b,c){if(b===0)return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((p||(p=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,m,r,t,v,w,x,y,z,A,B,C){B===void 0&&(B=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""])),x!=null?x:"",f,y,g.length);C=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(p||(p=d("I64"))).of_string(f)));C==null&&d("EBLogger").EBLogger.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"])),f);C=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&y==null&&f!=null;var D=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");yield s(a,D,C);try{D=(yield q(a,f));if(C&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",x!=null?x:""]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""])),f);d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(z,x);C={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};yield d("MAWBridgeUpdateClientRestoreStatus").call(a,C);yield b("cr:4992")(a,e,f,g,m,r,t,v,w,x,y,D,z,A,B)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""])),f,y,g.length);return u(e,f,g,D,m,t,w,x,y,z,A,B).then(function(){x!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:x})})}}catch(e){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to restore messages for thread "," with error: ",""])),f,e);return x!=null?d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(o||(o=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:x,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(n||(n=b("Promise"))).reject(e)}):(n||(n=b("Promise"))).reject(e)}});return t.apply(this,arguments)}function u(a,e,f,g,h,i,j,k,l,o,p,q){var r=(m||(m=c("ExecutionEnvironment"))).isInWorker?d("MAWJobManager").getJobManager():d("MAWTimedJob").TimedUIJobStarters;if(k!=null&&o===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION)return r.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:q},p)).then(function(a){if(a.success===!0)d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(k);else{var b;d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(k,(b=a.payload)!=null?b:c("err")(a.error))}});return o===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?r.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)).then(function(){return(n||(n=b("Promise"))).resolve()}):(n||(n=b("Promise"))).resolve(r.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)))}g.call=a}),98);
__d("MWEBRestoreUpsellTrigger.react",["MAWEncryptedBackupsRestoreDialog.entrypoint","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsRetrieveQplLoggingAnnotations","QPLUserFlow","react","react-compiler-runtime","useLabyrinthLogging","useMWXEntryPointDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i;i||d("react");function a(a){var b=d("react-compiler-runtime").c(17),e=a.children,f=a.markerPrefix,g=a.qplSource,i=(h||(h=c("useReStore")))();b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={},b[0]=a):a=b[0];a=c("useMWXEntryPointDialog")(c("MAWEncryptedBackupsRestoreDialog.entrypoint"),a);var j=a[0];a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var k=a.startFlow;b[1]!==i||b[2]!==g||b[3]!==k?(a=function(a){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:i,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,h=b.hasEbKeysLocally,i=b.hasEBSM,j=b.hasPDB,l=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;k({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:h,has_ebsm:i,has_pdb:j,has_user_restored_before:l,has_user_restored_before_temp:b,restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:g});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a)}})},b[1]=i,b[2]=g,b[3]=k,b[4]=a):a=b[4];var l=a;b[5]!==f||b[6]!==l?(a={onVisible:function(){l(f+"_IMPRESSION")}},b[5]=f,b[6]=l,b[7]=a):a=b[7];a=c("useVisibilityObserver")(a);var m;b[8]!==f||b[9]!==g||b[10]!==j||b[11]!==l?(m=function(){l(f+"_CLICKED"),j({source:g})},b[8]=f,b[9]=g,b[10]=j,b[11]=l,b[12]=m):m=b[12];m=m;var n;b[13]!==e||b[14]!==m||b[15]!==a?(n=e(m,a),b[13]=e,b[14]=m,b[15]=a,b[16]=n):n=b[16];return n}g["default"]=a}),98);
__d("MWInboxMessageSearchEBRestoreUpsell.react",["fbt","MWChatEncryptedBackupsQPLSource.enum","MWEBRestoreUpsellTrigger.react","MWXCard.react","MWXLink.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("MWEBRestoreUpsellTrigger.react"),{markerPrefix:"RESTORE_INBOX_MESSAGE_SEARCH",qplSource:c("MWChatEncryptedBackupsQPLSource.enum").INBOX_MESSAGE_SEARCH,children:k}),a[0]=b):b=a[0];return b}function k(a,b){return j.jsx(c("MWXCard.react"),{background:"card-flat",children:j.jsx("div",babelHelpers["extends"]({className:"xyamay9 x1l90r2v x1g0dm76 xpdmqnj"},{ref:b,children:j.jsxs(c("MWXText.react"),{align:"center",color:"primary",type:"body4",children:[h._(/*BTDS*/"Thi\u1ebfu tin nh\u1eafn.")," ",j.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:j.jsx(c("MWXLink.react"),{onClick:a,children:h._(/*BTDS*/"Kh\u00f4i ph\u1ee5c ngay")})})]})}))})}k.displayName=k.name+" [from "+f.id+"]";g["default"]=a}),226);