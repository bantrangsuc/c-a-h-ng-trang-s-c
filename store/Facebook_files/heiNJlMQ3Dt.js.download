;/*FB_PKG_DELIM*/

__d("MAWMediaDownloadStatusUIStateV2",["I64","LSAuthorityLevel","LSIntEnum","LSMediaUrlUtils","MAWClientMediaStatusUtils","MAWMediaDownloadStatus","MessagingAttachmentType","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS(["MediaDownload"]),l=5;function m(a,b,e){if((e==null?void 0:e.receiverFetchId)!=null&&d("LSMediaUrlUtils").hasValidReceiverFetchPreviewUrl(e.previewUrl,e.previewUrlExpirationTimestampMs))return"downloaded";b=b>=l;var f=a!=null?a:{},g=f.mainMediaStatus;f=f.previewMediaStatus;var i=a==null||g===c("MAWMediaDownloadStatus").DOWNLOADING||g===c("MAWMediaDownloadStatus").MISSING_FILE||g===c("MAWMediaDownloadStatus").RETRYING||g===c("MAWMediaDownloadStatus").AUTOMATICALLY_RETRYABLE_TIMEOUT_FAILURE,j=g===c("MAWMediaDownloadStatus").SUCCESS,m=g===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,o=m&&b;g=g===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;a=a==null||f===c("MAWMediaDownloadStatus").RETRYING||f===c("MAWMediaDownloadStatus").DOWNLOADING||f===c("MAWMediaDownloadStatus").MISSING_FILE||f===void 0&&i;var p=f===c("MAWMediaDownloadStatus").SUCCESS,q=f===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE||f===void 0&&m;b=q&&b;f=f===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE||f===void 0&&g;e=e!=null&&n(e);if(e&&!a){if(p||j){if(g||o)return"non_retryable_error_with_preview";else if(m)return"retryable_error_with_preview";return"downloaded"}else if(f||b)return"non_retryable_error";else if(q)return"retryable_error"}else if(j)return"downloaded";else if(g||o)return"non_retryable_error";else if(m)return"retryable_error";else if(i)return"loading";k.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["useMAWMediaDownloadStatusUIState: unexpected download status"])));return"loading"}function a(a,b,e){var f=(e==null?void 0:e.transportKey)==="FBBroker"||(e==null?void 0:e.transportKey)==="FBLegacyBroker";f=!f&&e!=null&&(i||(i=d("I64"))).to_int32(e.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;f=f&&b!=null?{id:b,mainMediaStatus:(j||(j=d("LSIntEnum"))).ofNumber(1),mainMediaStatusDetails:"optimistic_secure_upload",previewMediaStatus:(j||(j=d("LSIntEnum"))).ofNumber(1),previewMediaStatusDetails:"optimistic_secure_upload"}:a;b=f!=null?d("MAWClientMediaStatusUtils").getMAWMediaStatus(f):null;a=m(b,(i||(i=d("I64"))).to_int32((a=f==null?void 0:f.downloadRetryCount)!=null?a:(i||(i=d("I64"))).zero),e);return{mawMediaStatus:b,nonDebouncedUIState:a,status:f}}function n(a){if(a==null)return!1;a=a.attachmentType;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))}g.getMediaDownloadStatusUIState=m;g.getNonDebouncedUIStateAndStatusV2=a}),98);
__d("useMAWBulkMediaDownloadStatus",["I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSendAndReceive","MAWClientMediaStatusUtils","MAWDbMedia","MAWMediaDownloadStatus","MAWMediaSetClientMediaStatus","MAWStateContext.react","MessagingAttachmentType","WAHashUtils","isReceiverFetchSticker","promiseDone","react","react-compiler-runtime","useAsyncReStore","useClientMediaStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useContext,l=b.useEffect;b.useMemo;var m=new Set();function a(a){var b=d("react-compiler-runtime").c(7),e=c("useClientMediaStatus")(a);if(b[0]!==a||b[1]!==e){var f;b[3]!==e?(f=function(a,b){var f=a.attachment,g=a.mediaRenderQpl,h=a.mediaStatus;a=a.statusKey;var k=c("isReceiverFetchSticker")(f),l=(i||(i=d("I64"))).equal(f.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA));h=d("MAWClientMediaStatusUtils").getStatusDataFromLsdb({clientMediaStatus:e,preloadedMediaStatus:h,statusKey:a});var m=h.hasStatus,n=h.retryCount;h=h.statusData;var o=f.transportKey==="FBBroker"||f.transportKey==="FBLegacyBroker",p=!o&&(i||(i=d("I64"))).to_int32(f.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;h=p?{mainMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,mainMediaStatusDetails:"optimistic_secure_upload",previewMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,previewMediaStatusDetails:"optimistic_secure_upload"}:h;return{attachmentsData:{attachment:f,hasStatus:m,isOpenThreadAttachment:o,isOptimisticSecureUpload:p,isReceiverFetch:k,isXMA:l,retryCount:n,status:h,statusKey:a},index:b,mediaRenderQpl:g}},b[3]=e,b[4]=f):f=b[4];f=a.map(f);b[0]=a;b[1]=e;b[2]=f}else f=b[2];a=f;f=a;o(f);b[5]!==f?(a=f.map(n),b[5]=f,b[6]=a):a=b[6];f=a;return f}function n(a){a=a.attachmentsData;return a}function o(a){var b=d("react-compiler-runtime").c(7),e=c("useAsyncReStore")(),f=k(d("MAWStateContext.react").MAWDispatchContext),g;b[0]!==a||b[1]!==e?(g=function(){a.forEach(function(a){var b=a.attachmentsData,f=a.index,g=a.mediaRenderQpl;a=b.hasStatus;var h=b.isOpenThreadAttachment,i=b.isOptimisticSecureUpload,j=b.isReceiverFetch,k=b.isXMA,l=b.statusKey;if(k||i||h||j||l==null||a||m.has(l))return;m.add(l);var n=isNaN(l);g==null||g.addPoint("fetch-initial-download-status-"+f+"-start",{string:{fetch_by:n?"plaintext_hash":"media_id"}});b=n?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByPlaintextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(l),qplInstanceKey:g==null?void 0:g.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(l,10)),qplInstanceKey:g==null?void 0:g.getInstanceKey()});c("promiseDone")(b.then(function(a){g==null||g.addPoint("fetch-initial-download-status-"+f+"-end",{bool:{has_result:a!=null},string:{fetch_by:n?"plaintext_hash":"media_id",main_media_status:d("MAWClientMediaStatusUtils").mediaDownloadStatusEnumToString(a==null?void 0:a.mainMediaStatus),preview_media_status:d("MAWClientMediaStatusUtils").mediaDownloadStatusEnumToString(a==null?void 0:a.previewMediaStatus)}}),a!=null&&d("MAWMediaSetClientMediaStatus").call(e,l,a)}))})},b[0]=a,b[1]=e,b[2]=g):g=b[2];var h;b[3]!==a||b[4]!==e||b[5]!==f?(h=[f,a,e],b[3]=a,b[4]=e,b[5]=f,b[6]=h):h=b[6];l(g,h)}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIStateNonDebounced",["MAWMediaDownloadStatusUIStateV2","react","react-compiler-runtime","useMAWBulkMediaDownloadStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a){var b=d("react-compiler-runtime").c(5),e=c("useMAWBulkMediaDownloadStatus")(a);if(b[0]!==e||b[1]!==a){var f;b[3]!==a?(f=function(b,c){var e=b.retryCount;b=b.status;c=a[c].attachment;return d("MAWMediaDownloadStatusUIStateV2").getMediaDownloadStatusUIState(b,e,c)},b[3]=a,b[4]=f):f=b[4];f=e.map(f);b[0]=e;b[1]=a;b[2]=f}else f=b[2];e=f;return e}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIStateDebounced",["clearTimeout","justknobx","react","react-compiler-runtime","setTimeout","useMAWBulkMediaDownloadStatusUIStateNonDebounced"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef,k=b.useState;function a(a){var b=d("react-compiler-runtime").c(4),e=c("useMAWBulkMediaDownloadStatusUIStateNonDebounced")(a);a=m(e);var f=a[0],g=a[1],h;b[0]!==e||b[1]!==g?(a=function(){g(e,!e.some(l))},h=[e,g],b[0]=e,b[1]=g,b[2]=a,b[3]=h):(a=b[2],h=b[3]);i(a,h);return f}function l(a){return a==="loading"||a==="downloaded"}function m(a){var b=d("react-compiler-runtime").c(5),e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=c("justknobx")._("3145"),b[0]=e):e=b[0];var f=e;e=k(a);a=e[0];var g=e[1],h=j(null);b[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=function(){c("clearTimeout")(h.current),h.current=null},b[1]=e):e=b[1];var i=e;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=function(a,b){i();if(!b){g(a);return}h.current=c("setTimeout")(function(){g(a)},f)},b[2]=e):e=b[2];e=e;b[3]!==a?(e=[a,e,i],b[3]=a,b[4]=e):e=b[4];return e}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIState",["useMAWBulkMediaDownloadStatusUIStateDebounced"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("useMAWBulkMediaDownloadStatusUIStateDebounced")(a)}g["default"]=a}),98);
__d("useMAWBulkMediaValidationResult",["I64","LSIntEnum","MAWBridgeSendAndReceive","MAWClientMediaStatusUtils","MAWDbMedia","MAWMediaSetMediaValidatedResult","MessagingAttachmentType","WAHashUtils","promiseDone","react","react-compiler-runtime","useAsyncReStore","useClientMediaStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useEffect;b.useMemo;var l=new Set();function m(a){var b=d("react-compiler-runtime").c(4),e=c("useAsyncReStore")(),f,g;b[0]!==a||b[1]!==e?(f=function(){a.forEach(function(a){var b=a.attachment;a=a.mediaRenderQpl;var f=(i||(i=d("I64"))).equal(b.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)),g=i.equal(b.attachmentType,j.ofNumber(c("MessagingAttachmentType").AUDIO)),h=b.attachmentFbid;if(!l.has(h)&&(f||g)){l.add(h);var k=isNaN(h);b=k?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaValidationResultByPlainTextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(h),qplInstanceKey:a==null?void 0:a.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaValidationResultByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(h,10)),qplInstanceKey:a==null?void 0:a.getInstanceKey()});c("promiseDone")(b.then(function(a){if(a!=null){var b=k?d("WAHashUtils").stringToPlaintextHash(h):d("MAWDbMedia").convertNumberToMediaId(parseInt(h,10));d("MAWMediaSetMediaValidatedResult").call(e,b.toString(),a)}}),n)}})},g=[a,e],b[0]=a,b[1]=e,b[2]=f,b[3]=g):(f=b[2],g=b[3]);k(f,g)}function n(){}function a(a){var b=d("react-compiler-runtime").c(9),e=c("useClientMediaStatus")(a);m(a);var f,g;b[0]!==a||b[1]!==e?(f=function(){for(var b of a){var f=b.attachment,g=b.mediaRenderQpl,h=b.statusKey;f=(i||(i=d("I64"))).equal(f.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO));if(!f)continue;f=d("MAWClientMediaStatusUtils").getStatusDataFromLsdb({clientMediaStatus:e,statusKey:h});h=f.hasStatus;f=f.statusData;if(!h)continue;h=f==null?void 0:f.validationResult;if(h==null)continue;g==null||g.addAnnotations({"int":{audio_avg_bits_per_second:h.audioAvgBitsPerSecond,audio_number_of_channels:h.audioNumberOfChannels,audio_sampling_rate:h.audioSamplingRate,video_avg_bits_per_second:h.videoAvgBitsPerSecond,video_calculated_fps:h.videoCalculatedFps,video_duration:h.videoDuration,video_height:h.videoHeight,video_nominal_fps:h.videoNominalFps,video_width:h.videoWidth},string:{audio_stream_type:h.audioStreamType,validated_mime_type:h.validatedMimeType,video_stream_type:h.videoStreamType}})}},g=[a,e],b[0]=a,b[1]=e,b[2]=f,b[3]=g):(f=b[2],g=b[3]);k(f,g);if(b[4]!==a||b[5]!==e){b[7]!==e?(f=function(a){var b=a.attachment;a=a.statusKey;b=(i||(i=d("I64"))).equal(b.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO));if(!b)return null;b=d("MAWClientMediaStatusUtils").getStatusDataFromLsdb({clientMediaStatus:e,statusKey:a});a=b.hasStatus;b=b.statusData;if(!a)return null;a=b==null?void 0:b.validationResult;return a==null?null:a},b[7]=e,b[8]=f):f=b[8];g=a.map(f);b[4]=a;b[5]=e;b[6]=g}else g=b[6];f=g;return f}g["default"]=a}),98);
__d("useMAWBulkMediaUIState",["react","react-compiler-runtime","useMAWBulkMediaDownloadStatusUIState","useMAWBulkMediaValidationResult"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a){var b=d("react-compiler-runtime").c(5),e=c("useMAWBulkMediaDownloadStatusUIState")(a);a=c("useMAWBulkMediaValidationResult")(a);var f;b[0]!==a?(f=a!=null?a:[],b[0]=a,b[1]=f):f=b[1];b[2]!==e||b[3]!==f?(a={buldValidationResult:f,bulkDownloadStatus:e},b[2]=e,b[3]=f,b[4]=a):a=b[4];e=a;f=e;return f}g["default"]=a}),98);
__d("useMAWMediaDownloadStatus",["react","react-compiler-runtime","useMAWBulkMediaDownloadStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(4),g;f[0]!==a||f[1]!==e||f[2]!==b?(g=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:e!=null?e:a.attachmentFbid}]:[],f[0]=a,f[1]=e,f[2]=b,f[3]=g):g=f[3];a=g;e=a;b=c("useMAWBulkMediaDownloadStatus")(e);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMAWMediaDownloadStatusUIState",["react","react-compiler-runtime","useMAWBulkMediaDownloadStatusUIState"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(4),g;f[0]!==a||f[1]!==e||f[2]!==b?(g=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:e!=null?e:a.attachmentFbid}]:[],f[0]=a,f[1]=e,f[2]=b,f[3]=g):g=f[3];a=g;e=a;b=c("useMAWBulkMediaDownloadStatusUIState")(e);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMAWMediaValidationResultState",["react","react-compiler-runtime","useMAWBulkMediaValidationResult"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(4),g;f[0]!==a||f[1]!==e||f[2]!==b?(g=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:e!=null?e:a.attachmentFbid}]:[],f[0]=a,f[1]=e,f[2]=b,f[3]=g):g=f[3];a=g;e=a;b=c("useMAWBulkMediaValidationResult")(e);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMAWMediaStatusUIState",["react-compiler-runtime","useMAWMediaDownloadStatusUIState","useMAWMediaValidationResultState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=d("react-compiler-runtime").c(3),g=c("useMAWMediaDownloadStatusUIState")(a,b,e);a=c("useMAWMediaValidationResultState")(a,b,e);f[0]!==g||f[1]!==a?(b={downloadStatus:g,validationResult:a},f[0]=g,f[1]=a,f[2]=b):b=f[2];return b}g["default"]=a}),98);
__d("useMediaDownloadStatusForGroup",["MAWMediaDownloadStatusUIStateType","react","react-compiler-runtime","useMAWBulkMediaUIState"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(19);bb0:{if(!b){f[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=[],f[0]=b):b=f[0];b=b;break bb0}if(f[1]!==e||f[2]!==a){var g;f[4]!==e?(g=function(a){var b=a.attachment;a=a.mediaStatus;return b==null?null:{attachment:b,mediaRenderQpl:e,mediaStatus:a,statusKey:b.attachmentFbid}},f[4]=e,f[5]=g):g=f[5];g=a.map(g).filter(Boolean);f[1]=e;f[2]=a;f[3]=g}else g=f[3];b=g}a=b;g=c("useMAWBulkMediaUIState")(a);b=g.bulkDownloadStatus;f[6]!==b?(g=b!=null?b:[],f[6]=b,f[7]=g):g=f[7];b=g;var h=b;f[8]!==h?(g=h.filter(j),f[8]=h,f[9]=g):g=f[9];b=g;g=b;if(f[10]!==a||f[11]!==h){f[13]!==h?(b=function(a,b){return d("MAWMediaDownloadStatusUIStateType").isRetryableErrorState(h[b])},f[13]=h,f[14]=b):b=f[14];b=a.filter(b).map(i);f[10]=a;f[11]=h;f[12]=b}else b=f[12];a=b;b=a;a=g.length;f[15]!==b||f[16]!==a||f[17]!==h?(g={attachmentsToRetryDownload:b,mediaDownloadErrorsCount:a,mediaDownloadStatuses:h},f[15]=b,f[16]=a,f[17]=h,f[18]=g):g=f[18];return g}function i(a){var b=a.attachment;a=a.mediaStatus;return{attachment:b,mediaStatus:a}}function j(a){return d("MAWMediaDownloadStatusUIStateType").isErrorState(a)}g["default"]=a}),98);